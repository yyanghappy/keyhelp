# 脚本保存问题已修复

## 问题

录制功能正常，但保存后脚本不在列表中显示。

## 原因

原来的代码使用了两个独立的AccessibilityService实例，导致数据不同步：
- `ScriptRecorder`内部创建的实例接收录制事件
- `record_page.dart`中通过Provider创建的实例用于状态检查
- 保存时用的是`ScriptRecorder`的实例，但数据在另一个实例中

## 解决方案

### 1. 简化ScriptRecorder

直接管理动作列表，移除对AccessibilityService的依赖：
```dart
class ScriptRecorder {
  List<ScriptAction> _actions = [];
  bool _isRecording = false;

  void recordTap(double x, double y) {
    if (!_isRecording) return;
    final action = ScriptAction(type: ActionType.tap, x: x, y: y);
    _actions.add(action);
  }

  Script createScript(String name) {
    return Script(...);
  }
}
```

### 2. TouchRecorder捕获触摸

使用Flutter的GestureDetector在UI层捕获触摸事件：
```dart
TouchRecorder(
  isRecording: _isRecording,
  onTap: _onTap,
  onSwipe: _onSwipe,
  onLongPress: _onLongPress,
  child: Scaffold(...),
)
```

### 3. 统一使用recorderProvider

`record_page.dart`中只使用一个Provider：
```dart
final recorderProvider = Provider<ScriptRecorder>((ref) {
  return ScriptRecorder();
});
```

所有操作都通过这个Provider的实例完成。

## 测试方法

1. 录制脚本：点击开始 → 执行操作 → 点击停止
2. 保存脚本：点击保存按钮
3. 查看列表：进入脚本列表页面
4. 执行脚本：点击播放图标

应用已更新，可以重新测试了！
