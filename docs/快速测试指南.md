# 快速测试指南

## 已修复的问题

### 1. Hive序列化错误 ✅
- **问题**：Duration类型无法直接序列化
- **解决**：改用int类型存储（durationMs），通过getter返回Duration对象
- **文件**：lib/core/models/script.dart

### 2. 脚本保存失败 ✅
- **问题**：只创建Script对象，未保存到Hive数据库
- **解决**：添加ScriptRepository.instance.saveScript(script)调用
- **文件**：lib/features/record/record_page.dart

### 3. 录制时间显示 ✅
- **问题**：UI层_timer未更新，显示不准确
- **解决**：在record_page中添加自己的Timer更新_duration
- **文件**：lib/features/record/record_page.dart

### 4. 代码结构错误 ✅
- **问题**：多余大括号破坏类结构
- **解决**：删除第69行的多余}
- **文件**：lib/features/record/record_page.dart

### 5. schedule_page兼容性 ✅
- **问题**：Script构造使用Duration而非durationMs
- **解决**：改为使用durationMs: 0
- **文件**：lib/features/schedule/schedule_page.dart

## 测试步骤

### 步骤1：录制脚本

1. 打开KeyHelp应用
2. 点击"脚本录制"
3. 输入名称（如"测试1"）
4. 点击"开始"按钮
5. 在屏幕任意位置点击5-6次
6. 观察顶部显示：
   - 应该看到红色横幅"录制中..."
   - 时间显示应该每秒递增（1秒, 2秒, 3秒...）
   - 动作数量应该增加（1个, 2个, 3个...）
7. 点击"停止"按钮
8. 观察时间停止

### 步骤2：保存脚本

1. 点击"保存"按钮
2. 应该看到绿色提示："脚本已保存: 测试1"
3. 观察控制台日志，不应该有Hive错误

### 步骤3：查看列表

1. 返回首页
2. 点击"脚本列表"
3. 应该能看到"测试1"脚本
4. 显示信息应该正确：
   - 动作数量：5
   - 时长：X秒X毫秒（如5秒230毫秒）

### 步骤4：执行脚本

1. 在"测试1"脚本上点击播放图标
2. 观察控制台日志
3. 应该看到：
   - 执行点击: (0.xxxx, 0.xxxx)
   - 每5个动作一条执行日志

### 步骤5：验证数据持久化

完全退出应用，重新打开：
1. 查看"脚本列表"
2. 脚本应该还在（Hive持久化）
3. 再次执行，应该仍然正常

## 预期结果

### 成功指标

- ✅ 录制过程中时间正确递增（1, 2, 3...秒）
- ✅ 动作数量正确累加
- ✅ 点击"保存"后显示成功提示
- ✅ 脚本在列表中显示
- ✅ 脚本详情显示正确的动作数量和时长
- ✅ 执行脚本时看到"执行点击"日志
- ✅ 控制台没有Hive错误
- ✅ 退出应用后脚本仍然存在

### 日志分析

#### 正常日志示例

```
开始录制
录制点击: (0.228, 0.588)
录制时长: 1秒
录制点击: (0.406, 0.674)
录制时长: 2秒
停止录制
```

#### 错误日志示例

如果看到以下错误，说明还有问题：

```
HiveError: Cannot write, unknown type: Duration
```

## 故障排除

### 问题1：时间不递增

**可能原因**：Timer未启动或未更新状态

**解决方法**：
1. 检查控制台是否打印"录制时长: X秒"
2. 检查UI是否显示"00:00:01"

### 问题2：点击保存后列表为空

**可能原因**：
1. Hive Box未正确打开
2. Script对象未正确创建
3. 保存失败但未捕获异常

**解决方法**：
1. 查看控制台是否有"脚本已保存"日志
2. 检查是否有异常日志
3. 清除应用数据：设置 → 应用 → 清除数据
4. 重新测试

### 问题3：执行脚本无反应

**可能原因**：
1. 无障碍服务未启用
2. Script.actions为空
3. AccessibilityService执行失败

**解决方法**：
1. 确保无障碍服务已启用（首页右上角图标为绿色）
2. 查看脚本详情，确认动作数量>0
3. 查看日志：应该有"执行点击"信息
4. 重新录制脚本

## 性能检查

- 录制100个动作应该流畅无卡顿
- 保存操作应该在1秒内完成
- 脚本列表加载应该快速
- 执行脚本时点击间隔应该合理

## 提示

1. **首次使用**：建议先录制简单脚本测试（点击屏幕中心3次）
2. **复杂脚本**：分步录制，避免一次录制过多动作
3. **坐标精度**：在不同分辨率下需要重新录制
4. **屏幕方向**：录制和执行时保持相同方向

应用已构建并安装，可以开始测试了！
