# 无障碍功能使用指南

## 功能说明

KeyHelp使用Android无障碍服务（AccessibilityService）来实现触控事件的监听和模拟。这是实现自动化操作的核心技术。

## 启用无障碍服务

### 首次启动

1. 打开KeyHelp应用
2. 首页顶部会显示橙色警告提示"无障碍服务未启用"
3. 点击右上角的警告图标或页面上的"去设置"按钮
4. 在系统设置中找到"KeyHelp"并点击
5. 开启无障碍服务开关
6. 返回应用，警告提示应消失，右上角图标变为绿色

### 手动启用

如果需要手动启用：

1. 打开系统设置
2. 进入"辅助功能"或"无障碍"
3. 找到"KeyHelp - KeyHelp自动化工具"
4. 点击并启用

## 功能使用

### 脚本录制

启用无障碍服务后：

1. 点击首页"脚本录制"
2. 输入脚本名称
3. 点击"开始"按钮
4. 在屏幕上执行操作：
   - **点击**: 点击任意位置
   - **滑动**: 从一个点滑动到另一个点
   - **长按**: 长按某个位置
5. 点击"停止"按钮结束录制
6. 点击"保存"保存脚本

### 脚本执行

1. 进入"脚本列表"
2. 找到要执行的脚本
3. 点击播放图标
4. 无障碍服务会自动执行所有录制的操作

### 定时任务

1. 进入"定时任务"
2. 创建新的定时任务
3. 选择要执行的脚本
4. 设置执行时间
5. 启用任务开关

## 权限说明

### 必需权限

- **无障碍服务**: 核心功能，用于监听和模拟触控操作
- **系统悬浮窗**: 用于显示执行状态（可选）
- **电池优化白名单**: 保证定时任务在后台正常执行（可选）

### 权限安全性

KeyHelp是个人自用工具，所有数据均存储在本地，不会上传到任何服务器。

无障碍服务仅用于：
- 监听您的操作进行录制
- 回放录制的操作
- 执行定时任务

不会收集任何个人信息或敏感数据。

## 技术原理

### AccessibilityService

无障碍服务是Android系统提供的一种辅助功能接口，原本用于帮助残障人士更好地使用手机。

KeyHelp利用这一接口：
- **GestureDescription**: 用于构建手势描述
- **dispatchGesture()**: 执行手势操作

### 触控模拟

```java
// 示例：点击操作
Path path = new Path();
path.moveTo(x, y);

GestureDescription.Builder builder = new GestureDescription.Builder();
builder.addStroke(new GestureDescription.StrokeDescription(path, 0, 100));

GestureDescription gesture = builder.build();
dispatchGesture(gesture, null, null);
```

### 坐标系统

KeyHelp使用屏幕像素坐标：
- 原点(0,0)在屏幕左上角
- x轴向右增加
- y轴向下增加
- 最大值为屏幕分辨率（如1080x2400）

## 常见问题

### 1. 无障碍服务无法启用

**原因**: Android系统对无障碍服务有安全限制

**解决方法**:
- 确保从官方应用商店或信任的来源安装
- 检查是否已授予"修改系统设置"权限
- 重启手机后再尝试

### 2. 脚本执行不准确

**原因**: 不同屏幕分辨率导致坐标偏移

**解决方法**:
- 在与录制时相同分辨率的设备上执行
- 等待屏幕稳定后再执行
- 避免在执行过程中旋转屏幕

### 3. 某些应用无法操作

**原因**: 部分应用限制了无障碍服务的访问

**解决方法**:
- 检查目标应用是否有安全限制
- 尝试使用其他自动化方式（如ADB）
- 这不是KeyHelp的问题，是应用本身的安全限制

### 4. 定时任务不执行

**原因**: 电池优化限制了后台任务

**解决方法**:
1. 打开系统设置
2. 进入"电池"或"电池优化"
3. 找到KeyHelp
4. 选择"不优化"或"无限制"

### 5. 服务意外关闭

**原因**: 系统内存不足或优化策略

**解决方法**:
- 重启无障碍服务
- 将KeyHelp加入电池优化白名单
- 定期检查服务状态

## 调试技巧

### 查看日志

```bash
# 查看应用日志
adb logcat | grep KeyHelpAccessibility

# 查看所有相关日志
adb logcat -s KeyHelpAccessibility:AccessibilityMethodChannel
```

### 测试无障碍服务

在脚本录制前，先测试基本操作：

1. 手动执行一个简单的点击脚本
2. 观察是否成功执行
3. 检查日志输出

### 坐标调试

如果脚本执行不准确：

1. 录制时记录关键位置的坐标
2. 执行时观察实际位置
3. 调整坐标或重新录制

## 安全提示

1. **不要分享脚本**: 脚本包含您的操作信息
2. **定期备份**: 重要脚本建议导出备份
3. **注意隐私**: 不要录制包含密码、验证码等敏感信息
4. **谨慎使用**: 自动化操作可能触发应用的风控

## 后续开发

计划中的功能：

- [ ] 图像识别定位（OCR）
- [ ] 条件判断和循环UI
- [ ] 脚本导入/导出
- [ ] 多设备同步
- [ ] 云端脚本存储
- [ ] 脚本市场
